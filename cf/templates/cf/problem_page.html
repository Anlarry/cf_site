{% load static %}
<link rel = 'stylesheet' type="text/css" href="{% static 'cf/waiting.css' %}">
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$$$','$$$']], displayMath: [['$$$$$$','$$$$$$']]}
    });
    </script>
    <script type="text/javascript" async
            src="https://cdn.bootcss.com/mathjax/2.7.2-rc/MathJax.js?config=TeX-AMS_HTML-full"
    >
    </script>
<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
<style>
    .problem_elem
    {
        width: 70%;
        margin:2em auto;
        background-color: #ddeeff;
        border-radius: 8px;
        padding: 2em;
    }
    .problem_elem .sample-test{
        background-color: #ddeeff;
    }
    .title
    {
        font-weight:550;
        font-size: 20px;
        color: #333333;;
    }
    .header
    {
        text-align: center;
    }
    .section-title
    {
        font-weight: 600;
        font-size: 20px;;
    }
    .sample-test
    {
        color:#333333;
        background-color: #ffffff;
    }
    .sub
    {
        width: 60%;
        margin:0 auto;
        text-align: right;
    }
</style>

<script>
    function show()  //显示隐藏层和弹出层
    {
        if(document.getElementById("hidebox").style.display == "none")
            document.getElementById("hidebox").style.display="block";  //显示弹出层
        else if(document.getElementById("hidebox").style.display == "block"){
            document.getElementById("hidebox").style.display="none";  //显示弹出层
        }
        else
            document.getElementById("hidebox").style.display="block";  //显示弹出层
    }
    function hide()  //去除隐藏层和弹出层
    {
       document.getElementById("hidebg").style.display="none";
       document.getElementById("hidebox").style.display="none";
    }
</script>
<style>
    /* body { margin:0px;padding:0px;text-align: center;} */
    #hidebg { position:absolute;left:0px;top:0px;
        background-color:#000;
        width:100%;  /*宽度设置为100%，这样才能使隐藏背景层覆盖原页面*/
        filter:alpha(opacity=60);  /*设置透明度为60%*/
        opacity:0.6;  /*非IE浏览器下设置透明度为60%*/
        display:none; /* http://www.jb51.net */
        z-Index:2;}
    #hidebox {
            width: 100%; height: 50%;background: #ffffff;;;display: none;
        }
    #content { text-align:center;cursor:pointer;z-Index:1;}
</style>

<script>
    function submit_detail_win()
    {
        window.open("{%url 'submit_detail' contest_id last_submit_id %}");
    }

$(document).ready(function() {
    // $('#test').click(function(){
        var status = $('#status');
        var time = $('#time');
        var memory = $('#memory');
        var need_update = true;
        var is_ac = Boolean("{{is_ac}}" == "True")
        // if(status.text().indexOf("Run") == -1 && time.text().indexOf("0") != -1 && status.text().indexOf("Compilation error") == -1 && memory.text().indexOf("0") != -1){
        //     status.text("Running");
        // }
        if(is_ac){
            $("#ac_div").show();
        }
            
        while(need_update){
            need_update = need_update && (status.text().indexOf("Running") != -1);
            if(!need_update) {
                $(".spinner").hide();
                break;
            }
            else{
                $(".spinner").show();
            }
            $.ajax({
                type:'post',
                async:false,
                url:"{%url 'status'%}",
                data:{
                    'contest_id':"{{contest_id}}",
                    'submit_id':"{{last_submit_id}}",
                    'pro_id':"{{pro_id}}",
                    "user":"{{user}}",
                    'csrfmiddlewaretoken':"{{csrf_token}}"
                },
                dataType:'json',
                success:function(ret){
                    status.text(ret['verdict']);
                    time.text(ret['time']);
                    memory.text(ret['memory']); 
                    if(ret['verdict'].indexOf("Accept") != -1|| ret['verdict'].indexOf("Happy") != -1){
                        $("#ac_div").show();
                    }
                }
            })
            // $.getJSON("{%url 'status' %}", {'contest_id':"{{contest_id}}", 'submit_id':"{{last_submit_id}}" }, function(ret){
            //     status.text(ret['verdict']);
            //     time.text(ret['time']);
            //     memory.text(ret['memory']);
            // })
        }
    // })
    
})
</script>

<div style="width: 1250px;margin: auto;">
<h1 style="text-align: center;">{{name}}</h1>
<div style="text-align: center;font-size: 15px;">
    <div>{{time_lim}}</div>
    <div>{{mem_lim}}</div>
    <div>{{in_file}}</div>
    <div>{{out_file}}</div>
    <br>
</div>
<div style="text-align: center; ">
    <a href="http://codeforces.com/{{url}}" style="text-decoration: none;">CF 链接</a>
    <a href="https://vjudge.net/problem/CodeForces-{{pro_id}}" style="text-decoration: none;">VJ 链接</a>
    <a href="{%url 'tutorial_page' pro_id%}" style="text-decoration: none;">Tutotial</a>
</div>
<HR style="FILTER: alpha(opacity=100,finishopacity=0,style=1)" width="100%" color=#987cb9 SIZE=3>


<div class="problem_elem">
    {{text|safe}}
</div>

<br>


<div class="sub">
    <form method="POST">
    {%csrf_token%}
    <table style="margin: auto; text-align: center;">
        <tr>
        <td>
            <div class="spinner" style="display: none;">
                <div class="double-bounce1"></div>
                <div class="double-bounce2"></div>
            </div>
            <div id="ac_div" style="width: 12px;height: 12px;border-radius: 100%;background:rgb(7, 197, 64); display: none;"></div>
        </td>
        <td style="width: 100px;">Status</td>
        {%if status == None or status == "" %}
            <td style="width: 100px; text-align: center;">======</td>
            <td style="width: 60px; text-align: center;">===</td>
            <td style="width: 60px; text-align: center;">===</td>
        {%elif last_submit_id == 0%}
            <td style="width: 100px; cursor: pointer;">{{status}}</td>
        {%else%}
            <td style="width: 100px; cursor: pointer;" onclick="submit_detail_win()" id="status">{{status}}</td>
            <td style="width: 60px; text-align: center;" id="time">{{time}}<td>
            <td style="width: 60px; text-align: center;" id="memory">{{memory}}<td>
        {%endif%}
        <td style="width: 100px;"><div onclick="show()" style="cursor: pointer;">Code</div></td>
        <td style="width: 100px;">
        <select name="Language">
            <option value="54">GNU G++17 7.3.0</option>
            <option value="50">GNU G++14 6.4.0</option>
            <option value="43">GNU GCC C11 5.1.0</option>
            <option value="60">Java 11.0.5</option>
            <option value="36">Java 1.8.0_162</option>
            <option value="31">Python 3.7.2</option>
            <option value="41">PyPy 3.6 (7.2.0)</option>
        </td> 
            <td style="width: 100px;"><input type="submit" value="Submit" style="text-align:right;margin: auto;"></td>
        </tr>
    </table>
        <div id="hidebox" style="text-align:center;">
                <textarea name="code" style="width: 667px; height: 373px;margin: 0 auto;text-align: left;"></textarea>
        </div>
    </form>
</div>
</div>

<!-- <button id="test">test</button> -->

